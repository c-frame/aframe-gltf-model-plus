/*! For license information please see gltf-model-plus.min.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("THREE"));else if("function"==typeof define&&define.amd)define(["THREE"],t);else{var i="object"==typeof exports?t(require("THREE")):t(e.THREE);for(var s in i)("object"==typeof exports?exports:e)[s]=i[s]}}(self,(e=>(()=>{var t={527:()=>{AFRAME.registerComponent("reflection-probe",{schema:{size:{default:1},envMapTexture:{type:"map"}},init:function(){this.el.object3D.updateWorldMatrix(!0,!1);const e=(new THREE.Box3).setFromCenterAndSize(new THREE.Vector3,(new THREE.Vector3).setScalar(2*this.data.size)).applyMatrix4(this.el.object3D.matrixWorld);this.el.setObject3D("probe",new THREE.ReflectionProbe(e,this.data.envMapTexture))}})},114:()=>{const e=new Map,t=[];AFRAME.registerSystem("uv-scroll",{tick(i,s){for(let i=0;i<t.length;i++){const n=t[i],{offset:o,instances:a}=e.get(n),{component:r}=a[0];o.addScaledVector(r.data.speed,s/1e3),o.x=o.x%1,o.y=o.y%1;const l=r.data.increment;n.offset.x=l.x?o.x-o.x%l.x:o.x,n.offset.y=l.y?o.y-o.y%l.y:o.y}}}),AFRAME.registerComponent("uv-scroll",{schema:{speed:{type:"vec2",default:{x:0,y:0}},increment:{type:"vec2",default:{x:0,y:0}}},play(){const i=this.el.getObject3D("mesh")||this.el.getObject3D("skinnedmesh"),s=i&&i.material;if(s){const n={component:this,mesh:i};this.instance=n,this.map=s.map||s.emissiveMap,this.map&&!e.has(this.map)?(e.set(this.map,{offset:new THREE.Vector2,instances:[n]}),t.push(this.map)):this.map?(console.warn("Multiple uv-scroll instances added to objects sharing a texture, only the speed/increment from the first one will have any effect"),e.get(this.map).instances.push(n)):this.el.components.material?this.el.addEventListener("materialtextureloaded",(()=>{this.map=s.map||s.emissiveMap,e.has(this.map)||(e.set(this.map,{offset:new THREE.Vector2,instances:[n]}),t.push(this.map))})):console.warn("Ignoring uv-scroll added to mesh with no scrollable texture.")}},pause(){if(this.map){const i=e.get(this.map).instances;i.splice(i.indexOf(this.instance),1),i.length||(e.delete(this.map),t.splice(t.indexOf(this.map),1))}}})},344:()=>{AFRAME.registerComponent("video-texture-target",{schema:{src:{default:""},fakeAlphaEnabled:{default:!1}},dependencies:["material"],init(){this.videoTexture=null,this.video=null,this.stream=null,this._setMediaStream=this._setMediaStream.bind(this),this.startVideoSharing=this.startVideoSharing.bind(this),this.stopVideoSharing=this.stopVideoSharing.bind(this),this.maybeStopVideoSharing=this.maybeStopVideoSharing.bind(this)},_setMediaStream(e){if(!this.mesh){const e=this.data.fakeAlphaEnabled,t=new THREE.ShaderMaterial({uniforms:{map:{type:"t",value:null}},defines:{FAKE_ALPHA_ENABLED:e?1:0},vertexShader:"\n            varying vec2 vUv;\n            void main() {\n              vUv = uv;\n              gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n            }\n          ",fragmentShader:"\n            varying vec2 vUv;\n            uniform sampler2D map;\n            void main() {\n              vec4 diffuseColor = texture2D(map, vUv);\n              gl_FragColor = vec4(diffuseColor.rgb, 1.0);\n              #if FAKE_ALPHA_ENABLED == 1\n              if (diffuseColor.g - diffuseColor.r > 0.15) {\n                gl_FragColor.a = 0.0;\n              }\n              #endif\n            }\n          "});e&&(t.transparent=!0);let i=1,s=1;const n=this.el.getObject3D("mesh")?.geometry;if(n)i=n.parameters.width,s=n.parameters.height;else{const e=this.el.getAttribute("media-frame");e&&(i=e.bounds.x,s=e.bounds.y)}const o=Math.max(i,s),a=new THREE.PlaneGeometry(o,o,1,1);t.side=THREE.DoubleSide,this.mesh=new THREE.Mesh(a,t),this.mesh.visible=!1,this.el.setObject3D("screen",this.mesh)}if(this.video||this.setupVideo(),e!==this.stream){if(this.stream&&this._clearMediaStream(),e){this.video.srcObject=e;const t=this.video.play();t instanceof Promise&&t.catch((e=>NAF.log.error("Error play video stream",e))),this.videoTexture=new THREE.VideoTexture(this.video);const i=this.el.getObject3D("mesh");i&&(i.visible=!1),this.mesh.material.uniforms.map.value=this.videoTexture,this.mesh.material.needsUpdate=!0}this.stream=e}},_clearMediaStream(){if(this.stream=null,this.videoTexture){if(this.videoTexture.image instanceof HTMLVideoElement){const e=this.videoTexture.image;e.pause(),e.srcObject=null,e.load(),this.el.sceneEl.emit("video-removed",{video:this.video,el:this.el})}this.videoTexture.dispose(),this.videoTexture=null;const e=this.el.getObject3D("mesh");e&&(e.visible=!0),this.mesh&&(this.mesh.visible=!1,this.mesh.material.map=null,this.mesh.material.needsUpdate=!0,this.mesh.scale.set(1,1,1),this.mesh.matrixNeedsUpdate=!0)}},async update(e){const t=this.data.src;if(t.startsWith("naf://")){t!==e.src&&(this.isVideoSharing?t.substring(6).split("/")[1]!==NAF.clientId&&(this._clearMediaStream(),this.el.sceneEl.emit("action_end_video_sharing")):this._clearMediaStream());const i=t.substring(6).split("/"),s=i[1],n=i[2],o=await NAF.connection.adapter.getMediaStream(s,n);this._setMediaStream(o);const a=()=>{const e=this.videoTexture;return!!e&&(e.image.videoHeight||e.image.height)&&(e.image.videoWidth||e.image.width)},r=setInterval((()=>{const e=this.data.src!==t;if((a()||e)&&(clearInterval(r),!e)){const e=this.videoTexture,t=(e.image.videoHeight||e.image.height)/(e.image.videoWidth||e.image.width);this.scaleToAspectRatio(t),this.el.sceneEl.emit("video-added",{video:this.video,el:this.el,clientId:s})}}),500)}else!t&&e.src&&this._clearMediaStream()},remove(){this._clearMediaStream(),this.mesh&&(this.mesh.material.dispose(),this.mesh.geometry.dispose(),this.mesh=null,this.el.removeObject3D("screen")),this.video&&(this.video.remove(),this.video=null)},scaleToAspectRatio(e){const t=Math.min(1,1/e),i=Math.min(1,e);this.mesh&&(this.mesh.scale.set(t,i,1),this.mesh.matrixNeedsUpdate=!0,this.mesh.visible=!0)},setupVideo(){if(!this.video){const e=document.createElement("video");e.setAttribute("autoplay",!0),e.setAttribute("playsinline",!0),e.setAttribute("muted",!0),this.video=e}},startVideoSharing(e){this.isVideoSharing=!0,this.mediaSourceUsed=e.detail.source,NAF.utils.getNetworkedEntity(this.el).then((e=>{NAF.utils.isMine(e)||NAF.utils.takeOwnership(e)})).catch((()=>{console.error("networkedEl not found")}))},stopVideoSharing(){this.isVideoSharing&&(this.isVideoSharing=!1,NAF.utils.getNetworkedEntity(this.el).then((e=>{NAF.utils.isMine(e)&&this.el.setAttribute("video-texture-target",{src:""})})).catch((()=>{console.error("networkedEl not found")})))},maybeStopVideoSharing(e){const t=this.data.src;if(t.startsWith("naf://")){const i=t.substring(7).split("/")[1];this.el.sceneEl.is("naf:reconnecting")||i!==e.detail.clientId||this.el.setAttribute("video-texture-target",{src:""}),this.el.sceneEl.is("naf:reconnecting")&&i===NAF.clientId&&setTimeout((()=>{this.isVideoSharing&&(this.el.setAttribute("video-texture-target",{src:""}),setTimeout((()=>{this.el.setAttribute("video-texture-target",{src:t})})))}),5e3)}},play(){this.el.sceneEl.addEventListener("share_video_enabled",this.startVideoSharing),this.el.sceneEl.addEventListener("share_video_disabled",this.stopVideoSharing),document.body.addEventListener("clientDisconnected",this.maybeStopVideoSharing)},pause(){this.el.sceneEl.removeEventListener("share_video_enabled",this.startVideoSharing),this.el.sceneEl.removeEventListener("share_video_disabled",this.stopVideoSharing),document.body.removeEventListener("clientDisconnected",this.maybeStopVideoSharing)}})},210:()=>{!function(){const e=document.createElement("template"),t=document.createElement("a-entity");e.id="waypoint-template",e.appendChild(t);const i=`#${e.id}`;NAF.schemas.schemaDict[i]={template:i,components:[{component:"waypoint",property:"isOccupied"},{component:"waypoint",property:"occupiedBy"}]},NAF.schemas.templateCache[i]=e}();const e=String(crypto.getRandomValues(new Uint32Array(1))[0]);function t(){return NAF.clientId||e}AFRAME.registerSystem("waypoint",{init(){this.occupyWaypoint=!1,this.registeredWaypoints=[]},teleportTo(e,t,i=!0){const s=new THREE.Quaternion;s.setFromEuler(new THREE.Euler(0,THREE.MathUtils.degToRad(t.y),0));const n=document.querySelector("#rig,#cameraRig"),o=n.querySelector("[camera]"),a=n?.components["cursor-teleport"];if((i=i&&!n.sceneEl.is("vr-mode"))&&a)a.teleportTo(e,s);else{n.hasAttribute("simple-navmesh-constraint")&&n.setAttribute("simple-navmesh-constraint","enabled",!1);const t=o.object3D,i=new THREE.Quaternion;i.setFromEuler(new THREE.Euler(0,t.rotation.y,0)),i.invert(),i.multiply(s),n.object3D.position.copy(e),n.object3D.quaternion.copy(i),n.hasAttribute("simple-navmesh-constraint")&&n.setAttribute("simple-navmesh-constraint","enabled",!0)}o&&(o.components["look-controls"].pitchObject.rotation.x=THREE.MathUtils.DEG2RAD*t.x)},unoccupyWaypoint(){this.registeredWaypoints.forEach((e=>{e.components.networked&&e.components.waypoint.data.occupiedBy===t()&&(e.setAttribute("waypoint",{isOccupied:!1,occupiedBy:"scene"}),NAF.connection.adapter&&NAF.utils.takeOwnership(e))}));const e=document.querySelector("#rig,#cameraRig");this.occupyWaypoint=!1,e.setAttribute("player-info","avatarPose","stand")}}),AFRAME.registerComponent("waypoint",{schema:{canBeClicked:{type:"bool",default:!1},canBeOccupied:{type:"bool",default:!1},canBeSpawnPoint:{type:"bool",default:!1},snapToNavMesh:{type:"bool",default:!1},willDisableMotion:{type:"bool",default:!1},willDisableTeleporting:{type:"bool",default:!1},willMaintainInitialOrientation:{type:"bool",default:!1},isOccupied:{type:"bool",default:!1},occupiedBy:{type:"string",default:"scene"}},events:{"model-loaded":function(e){this.registerWaypoint(),this.el.classList.add("clickable");let t=this.el.object3D.getObjectByName("RootNode");!t.material&&t.children.length>0&&(t=t.children[0]),t&&t.material&&(this.mesh=t,this.originalColor||(this.originalColor=this.mesh.material.color.clone()),this.mesh.material.visible=!1)},mouseenter:function(e){this.mesh&&!this.data.isOccupied&&(this.mesh.material.color.set("#0284c7"),this.mesh.material.visible=!0)},mouseleave:function(e){this.mesh&&(this.mesh.material.color.set(this.originalColor),this.mesh.material.visible=!1)},"ownership-gained":function(e){!this.el.sceneEl.is("naf:reconnecting")&&this.data.isOccupied&&!1===NAF.connection.activeDataChannels[this.data.occupiedBy]&&setTimeout((()=>{NAF.utils.isMine(this.el)&&this.el.setAttribute("waypoint",{isOccupied:!1})}),2e3)},click:function(e){this.system.unoccupyWaypoint();const i=document.querySelector("#rig,#cameraRig"),s=i.querySelector("[camera]");this.system.occupyWaypoint=!0,this.el.components.networked&&(this.el.setAttribute("waypoint",{isOccupied:!0,occupiedBy:t()}),NAF.connection.adapter&&NAF.utils.takeOwnership(this.el));const n=this.el,o=this.data.canBeOccupied&&this.data.willDisableMotion?"sit":"stand";i.setAttribute("player-info","avatarPose",o);const a=new THREE.Vector3;a.copy(n.object3D.position);const r=i.components["player-info"],l=r.avatarSitOffset??.45;"sit"===r.data.avatarPose&&(a.y-=l);const c={x:0,y:(new THREE.Euler).setFromQuaternion(n.object3D.quaternion,"YXZ").y*THREE.MathUtils.RAD2DEG+180,z:0};this.system.teleportTo(a,c,!1),i.setAttribute("player-info",{seatRotation:s.object3D.rotation.y})}},registerWaypoint(){-1===this.system.registeredWaypoints.indexOf(this.el)&&this.system.registeredWaypoints.push(this.el)},unregisterWaypoint(){const e=this.system.registeredWaypoints.indexOf(this.el);e>-1&&this.system.registeredWaypoints.splice(e,1)},init(){this.data.canBeClicked&&this.data.canBeOccupied||this.registerWaypoint()},remove(){this.unregisterWaypoint()},update(e){this.data.isOccupied||this.data.occupiedBy!==t()||(this.el.sceneEl.systems.waypoint.registeredWaypoints.find((e=>this.el!==e&&e.components.networked&&e.components.waypoint.data.occupiedBy===t()))?this.el.setAttribute("waypoint",{isOccupied:!1,occupiedBy:"scene"}):this.el.setAttribute("waypoint",{isOccupied:!0}),NAF.connection.adapter&&NAF.utils.takeOwnership(this.el)),this.data.canBeClicked&&e.isOccupied!==this.data.isOccupied&&(this.data.isOccupied?(this.el.object3D.visible=!1,this.el.classList.remove("clickable")):(this.el.object3D.visible=!0,this.el.classList.add("clickable")))}}),AFRAME.registerComponent("move-to-spawn-point",{init(){this.move=this.move.bind(this)},play(){this.el.sceneEl.addEventListener("waypoints-ready",this.move)},pause(){this.el.sceneEl.removeEventListener("waypoints-ready",this.move)},move(){const e=this.el.sceneEl.systems.waypoint,t=e.registeredWaypoints.filter((e=>e.components.waypoint.data.canBeSpawnPoint)),i=t.length>0?t[0]:null;if(i){const t={x:0,y:(new THREE.Euler).setFromQuaternion(i.object3D.quaternion,"YXZ").y*THREE.MathUtils.RAD2DEG+180,z:0};e.teleportTo(i.object3D.position,t,!1)}else e.teleportTo({x:0,y:0,z:0},{x:0,y:0,z:0},!1);document.querySelector("#rig,#cameraRig").setAttribute("player-info","avatarPose","stand")}})},24:(e,t,i)=>{"use strict";e.exports=i.p+"a5716ef44f81f0cdfcd4.glb"},704:(e,t,i)=>{"use strict";e.exports=i.p+"c0dfa7cda0fb80959896.glb"},612:t=>{"use strict";t.exports=e}},i={};function s(e){var n=i[e];if(void 0!==n)return n.exports;var o=i[e]={exports:{}};return t[e](o,o.exports,s),o.exports}s.m=t,s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var n=i.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=i[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),s.b=document.baseURI||self.location.href;var n={};return(()=>{"use strict";s.r(n);var e=s(612);class t extends e.DataTextureLoader{constructor(t){super(t),this.type=e.HalfFloatType}parse(t){const i=function(e,t){switch(e){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(t||""))}},s=function(e,t,i){t=t||1024;let s=e.pos,n=-1,o=0,a="",r=String.fromCharCode.apply(null,new Uint16Array(e.subarray(s,s+128)));for(;0>(n=r.indexOf("\n"))&&o<t&&s<e.byteLength;)a+=r,o+=r.length,s+=128,r+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(s,s+128)));return-1<n&&(!1!==i&&(e.pos+=o+n+1),a+r.slice(0,n))},n=function(e,t,i,s){const n=e[t+3],o=Math.pow(2,n-128)/255;i[s+0]=e[t+0]*o,i[s+1]=e[t+1]*o,i[s+2]=e[t+2]*o,i[s+3]=1},o=function(t,i,s,n){const o=t[i+3],a=Math.pow(2,o-128)/255;s[n+0]=e.DataUtils.toHalfFloat(Math.min(t[i+0]*a,65504)),s[n+1]=e.DataUtils.toHalfFloat(Math.min(t[i+1]*a,65504)),s[n+2]=e.DataUtils.toHalfFloat(Math.min(t[i+2]*a,65504)),s[n+3]=e.DataUtils.toHalfFloat(1)},a=new Uint8Array(t);a.pos=0;const r=function(e){const t=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,n=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*FORMAT=(\S+)\s*$/,a=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,r={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,c;for((e.pos>=e.byteLength||!(l=s(e)))&&i(1,"no header found"),(c=l.match(/^#\?(\S+)/))||i(3,"bad initial token"),r.valid|=1,r.programtype=c[1],r.string+=l+"\n";l=s(e),!1!==l;)if(r.string+=l+"\n","#"!==l.charAt(0)){if((c=l.match(t))&&(r.gamma=parseFloat(c[1])),(c=l.match(n))&&(r.exposure=parseFloat(c[1])),(c=l.match(o))&&(r.valid|=2,r.format=c[1]),(c=l.match(a))&&(r.valid|=4,r.height=parseInt(c[1],10),r.width=parseInt(c[2],10)),2&r.valid&&4&r.valid)break}else r.comments+=l+"\n";return 2&r.valid||i(3,"missing format specifier"),4&r.valid||i(3,"missing image size specifier"),r}(a),l=r.width,c=r.height,d=function(e,t,s){const n=t;if(n<8||n>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);n!==(e[2]<<8|e[3])&&i(3,"wrong scanline width");const o=new Uint8Array(4*t*s);o.length||i(4,"unable to allocate buffer space");let a=0,r=0;const l=4*n,c=new Uint8Array(4),d=new Uint8Array(l);let h=s;for(;h>0&&r<e.byteLength;){r+4>e.byteLength&&i(1),c[0]=e[r++],c[1]=e[r++],c[2]=e[r++],c[3]=e[r++],2==c[0]&&2==c[1]&&(c[2]<<8|c[3])==n||i(3,"bad rgbe scanline format");let t,s=0;for(;s<l&&r<e.byteLength;){t=e[r++];const n=t>128;if(n&&(t-=128),(0===t||s+t>l)&&i(3,"bad scanline data"),n){const i=e[r++];for(let e=0;e<t;e++)d[s++]=i}else d.set(e.subarray(r,r+t),s),s+=t,r+=t}const p=n;for(let e=0;e<p;e++){let t=0;o[a]=d[e+t],t+=n,o[a+1]=d[e+t],t+=n,o[a+2]=d[e+t],t+=n,o[a+3]=d[e+t],a+=4}h--}return o}(a.subarray(a.pos),l,c);let h,p,m;switch(this.type){case e.FloatType:m=d.length/4;const t=new Float32Array(4*m);for(let e=0;e<m;e++)n(d,4*e,t,4*e);h=t,p=e.FloatType;break;case e.HalfFloatType:m=d.length/4;const i=new Uint16Array(4*m);for(let e=0;e<m;e++)o(d,4*e,i,4*e);h=i,p=e.HalfFloatType;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:l,height:c,data:h,header:r.string,gamma:r.gamma,exposure:r.exposure,type:p}}setDataType(e){return this.type=e,this}load(t,i,s,n){return super.load(t,(function(t,s){switch(t.type){case e.FloatType:case e.HalfFloatType:t.colorSpace=e.LinearSRGBColorSpace,t.minFilter=e.LinearFilter,t.magFilter=e.LinearFilter,t.generateMipmaps=!1,t.flipY=!0}i&&i(t,s)}),s,n)}}class i extends e.Loader{constructor(t){super(t),this.type=e.UnsignedByteType}setType(t){if(t!==e.UnsignedByteType&&t!==e.FloatType)throw new Error("LUTCubeLoader: Unsupported type");return this.type=t,this}load(t,i,s,n){const o=new e.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("text"),o.load(t,(e=>{try{i(this.parse(e))}catch(e){n?n(e):console.error(e),this.manager.itemError(t)}}),s,n)}parse(t){const i=/^([\d.e+-]+) +([\d.e+-]+) +([\d.e+-]+) *$/gm;let s=/TITLE +"([^"]*)"/.exec(t);const n=null!==s?s[1]:null;if(s=/LUT_3D_SIZE +(\d+)/.exec(t),null===s)throw new Error("LUTCubeLoader: Missing LUT_3D_SIZE information");const o=Number(s[1]),a=o**3*4,r=this.type===e.UnsignedByteType?new Uint8Array(a):new Float32Array(a),l=new e.Vector3(0,0,0),c=new e.Vector3(1,1,1);if(s=/DOMAIN_MIN +([\d.]+) +([\d.]+) +([\d.]+)/.exec(t),null!==s&&l.set(Number(s[1]),Number(s[2]),Number(s[3])),s=/DOMAIN_MAX +([\d.]+) +([\d.]+) +([\d.]+)/.exec(t),null!==s&&c.set(Number(s[1]),Number(s[2]),Number(s[3])),l.x>c.x||l.y>c.y||l.z>c.z)throw new Error("LUTCubeLoader: Invalid input domain");const d=this.type===e.UnsignedByteType?255:1;let h=0;for(;null!==(s=i.exec(t));)r[h++]=Number(s[1])*d,r[h++]=Number(s[2])*d,r[h++]=Number(s[3])*d,r[h++]=d;const p=new e.DataTexture;p.image.data=r,p.image.width=o,p.image.height=o*o,p.type=this.type,p.magFilter=e.LinearFilter,p.minFilter=e.LinearFilter,p.wrapS=e.ClampToEdgeWrapping,p.wrapT=e.ClampToEdgeWrapping,p.generateMipmaps=!1,p.needsUpdate=!0;const m=new e.Data3DTexture;return m.image.data=r,m.image.width=o,m.image.height=o,m.image.depth=o,m.type=this.type,m.magFilter=e.LinearFilter,m.minFilter=e.LinearFilter,m.wrapS=e.ClampToEdgeWrapping,m.wrapT=e.ClampToEdgeWrapping,m.wrapR=e.ClampToEdgeWrapping,m.generateMipmaps=!1,m.needsUpdate=!0,{title:n,size:o,domainMin:l,domainMax:c,texture:p,texture3D:m}}}const o=s.p+"assets/e6acb8ca8505336d09c6.cube",a={toneMapping:"LUTToneMapping",toneMappingExposure:1,backgroundColor:"skyblue",backgroundTexture:null,envMapTexture:null};let r;const l=e=>{e.traverse((e=>{e.material&&(e.material.needsUpdate=!0)}))};class c{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const i=this._listeners[e];if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){const i=t.slice(0);for(let t=0,s=i.length;t<s;t++)i[t].call(this,e)}}}const d={},h={},p={removeChild:()=>{}};class m extends c{constructor(e){super(),this.components={},this.initializingComponents={},this.object3D=e,this.sceneEl=e.el.sceneEl,this.object3D.el=this,this.isEntity=!0,this.isPlaying=!0,this.object3DMap={},this.rotationObj={},this.states=[],this.parentElement=this.sceneEl,this.parentNode=p,this.hasLoaded=!0,this.mixinEls=[],this.tagName="FAKE_ENTITY",this.isFakeEntity=!0}get children(){throw Error("FakeEntity el.children not implemented, try another way, maybe el.object3D.children")}addState(e){this.is(e)||(this.states.push(e),this.emit("stateadded",e))}removeState(e){const t=this.states.indexOf(e);-1!==t&&(this.states.splice(t,1),this.emit("stateremoved",e))}is(e){return-1!==this.states.indexOf(e)}getAttribute(e){if("position"===e)return this.object3D.position;if("rotation"===e)return function(e){const t=THREE.MathUtils.radToDeg,i=e.object3D.rotation,s=e.rotationObj;return s.x=t(i.x),s.y=t(i.y),s.z=t(i.z),s}(this);if("scale"===e)return this.object3D.scale;if("visible"===e)return this.object3D.visible;if("class"===e||"mixin"===e)return console.warn(`FakeEntity el.getAttribute('${e}') called`,this.object3D),"";const t=this.components[e];if(t)return t.data;throw Error(`FakeEntity el.getAttribute('${e}') not implemented`)}getDOMAttribute(e){return console.warn(`FakeEntity el.getDOMAttribute('${e}') called`,this.object3D),""}flushToDOM(){}removeAttribute(){throw Error("FakeEntity el.removeAttribute not implemented")}setAttribute(e,t,i){if(e.indexOf("__")>-1)throw Error(`FakeEntity setAttribute("${e}", ...) using multiple components of the same type is not supported`);if(!AFRAME.components[e]){if("id"===e)return void(this.id=t);throw Error(`FakeEntity setAttribute("${e}", ...) not supported, this is not a registered component`)}let s,n;if(void 0!==i&&"string"==typeof t&&t.length>0&&"string"==typeof AFRAME.utils.styleParser.parse(t)){for(const e in h)delete h[e];s=h,s[t]=i,n=!1}else s=t,n=!0===i;this.updateComponent(e,s,n)}updateComponent(e,t,i){const s=this.components[e];if(s)return null===t?void this.removeComponent(e,!0):void s.updateProperties(t,i);this.initComponent(e,t,!1)}initComponent(e,t,i){u(this.object3D,e,t)}removeComponent(e,t){const i=this.components[e];i&&(i.initialized?(i.pause(),i.remove(),t&&(i.destroy(),delete this.components[e]),this.emit("componentremoved",i.evtDetail,!1)):this.addEventListener("componentinitialized",(function i(s){s.detail.name===e&&(this.removeComponent(e,t),this.removeEventListener("componentinitialized",i))})))}getObject3D(e){return this.object3DMap[e]}setObject3D(e,t){const i=this.getObject3D(e);i&&this.object3D.remove(i),t.el=this;const s=this;t.children.length&&t.traverse((function(e){e.el=s})),t!==this.object3D&&this.object3D.add(t),this.object3DMap[e]=t,this.emit("object3dset",{object:t,type:e})}removeObject3D(e){const t=this.getObject3D(e);t?(this.object3D.remove(t),delete this.object3DMap[e],this.emit("object3dremove",{type:e})):console.warn("Tried to remove `Object3D` of type:",e,"which was not defined.")}emit(e,t,i,s){void 0===i&&(i=!0);let n=d;n.bubbles=!!i,n.detail=t,s&&(n=AFRAME.utils.extend({},s,n)),n.target=this,this.dispatchEvent(new CustomEvent(e,n)),n.target=null}destroy(){for(const e in this.components)this.removeComponent(e,!0);this.object3D.el=null,this.object3D=null,this.sceneEl=null,this.parentElement=null,this.parentNode=null}}const u=(e,t,i)=>{if(!AFRAME.components[t])return void console.error(`Component ${t} not registered`);e.fakeEl||(e.fakeEl=new m(e));const s=new AFRAME.components[t].Component(e.fakeEl,i,void 0);return s.play(),s},g=(e,t=void 0)=>{const i=e.el.sceneEl,s=document.createElement("a-entity");return t&&s.classList.add(t),i.appendChild(s),s.object3D.removeFromParent(),s.object3D=e,s.object3D.el=s,i.object3D.attach(e),s},f=new Map;f.set("environment-settings",(function(e,t){const s=e.object3D,n=e.renderer;let a=!1;const c=THREE[t.toneMapping];void 0!==c?(n.toneMapping!==c&&(n.toneMapping=c,c===THREE.LUTToneMapping?(r||(r=new Promise((function(e,t){(new i).load(o,(({texture3D:t})=>e(t)),null,t)}))),r.then((e=>{n.tonemappingLUT=e,l(s)})).catch((function(e){console.error("Error loading Blender LUT",e),r=null}))):(n.tonemappingLUT=null,a=!0)),n.toneMappingExposure=t.toneMappingExposure,t.backgroundTexture?(t.backgroundTexture.mapping=THREE.EquirectangularReflectionMapping,t.backgroundTexture.flipY=!0,s.background=t.backgroundTexture):s.background=new THREE.Color(t.backgroundColor),t.envMapTexture?(t.envMapTexture.flipY=!0,t.envMapTexture.mapping=THREE.EquirectangularReflectionMapping,s.environment=t.envMapTexture):s.environment=null,a&&l(s)):console.error("You need an aframe build with the tonemappingLUT patch to make LUTToneMapping work.")})),f.set("media-frame",(function(e,t,i){const s=g(e);return s.classList.add("mediaframe"),s.classList.add(e.name),s.setAttribute("networked",{template:"#media-template",attachTemplateToLocal:!1,networkId:i.networked.id,persistent:!0,owner:"scene"}),s.setAttribute("video-texture-target",{}),s.setAttribute("media-frame",t),s})),f.set("nav-mesh",(function(e,t,i){const s=e.el.sceneEl,n=document.createElement("a-entity");n.classList.add("navmesh"),n.setAttribute("nav-mesh",""),s.appendChild(n),n.setObject3D("mesh",e);const o=document.querySelector("#rig,#cameraRig");return o&&(o.removeAttribute("simple-navmesh-constraint"),o.setAttribute("simple-navmesh-constraint","navmesh:.navmesh;fall:0.5;height:0;exclude:.navmesh-hole;")),n})),f.set("reflection-probe",(function(e,t,i){void 0!==THREE.ReflectionProbe?(t.envMapTexture.flipY=!0,t.envMapTexture.mapping=THREE.EquirectangularReflectionMapping,u(e,"reflection-probe",t)):console.error("You need an aframe build with the ReflectionProbe patch to make reflection probes work.")})),f.set("uv-scroll",(function(e,t,i){e.fakeEl=new m(e),e.fakeEl.setObject3D("mesh",e),u(e,"uv-scroll",t)})),f.set("waypoint",(function(e,t,i){const n=g(e);return t.canBeOccupied&&n.setAttribute("networked",{template:"#waypoint-template",attachTemplateToLocal:!1,networkId:i.networked.id,persistent:!0,owner:"scene"}),n.setAttribute("waypoint",t),t.canBeClicked&&t.canBeOccupied&&(t.willDisableMotion?n.setAttribute("gltf-model",new URL(s(24),s.b).href):n.setAttribute("gltf-model",new URL(s(704),s.b).href)),n}));const v=/\.hdr$/,y=window.absoluteURLForAsset||(e=>e);AFRAME.registerComponent("environment-settings",{schema:{toneMapping:{type:"string",default:"LUTToneMapping",oneOf:["NoToneMapping","LinearToneMapping","ReinhardToneMapping","CineonToneMapping","ACESFilmicToneMapping","CustomToneMapping","LUTToneMapping"]},toneMappingExposure:{type:"number",default:1},backgroundTexture:{type:"string",default:""},backgroundColor:{type:"color",default:"skyblue"},envMapTexture:{type:"string",default:""}},init(){(async()=>{let e=null;if(this.data.backgroundTexture){const i=y(this.data.backgroundTexture),s=v.test(i);let n;n=s?(new t).setDataType(THREE.HalfFloatType):new THREE.TextureLoader,n.setWithCredentials(!1),e=await new Promise(((e,t)=>n.load(i,e,void 0,t))),e.minFilter===THREE.NearestMipmapNearestFilter||e.minFilter===THREE.NearestMipmapLinearFilter?e.minFilter=THREE.NearestFilter:e.minFilter!==THREE.LinearMipmapNearestFilter&&e.minFilter!==THREE.LinearMipmapLinearFilter||(e.minFilter=THREE.LinearFilter),s||(e.encoding=THREE.sRGBEncoding)}let i=null;if(this.data.envMapTexture){const e=y(this.data.envMapTexture),s=v.test(e);let n;n=s?(new t).setDataType(THREE.HalfFloatType):new THREE.TextureLoader,n.setWithCredentials(!1),i=await new Promise(((t,i)=>n.load(e,t,void 0,i))),i.minFilter===THREE.NearestMipmapNearestFilter||i.minFilter===THREE.NearestMipmapLinearFilter?i.minFilter=THREE.NearestFilter:i.minFilter!==THREE.LinearMipmapNearestFilter&&i.minFilter!==THREE.LinearMipmapLinearFilter||(i.minFilter=THREE.LinearFilter),s||(i.encoding=THREE.sRGBEncoding)}const s={toneMapping:this.data.toneMapping,toneMappingExposure:this.data.toneMappingExposure,backgroundTexture:e,backgroundColor:this.data.backgroundColor,envMapTexture:i};f.get("environment-settings")(this.el.sceneEl,s)})()}});class E{constructor(e,t){this.parser=e,this.loader=t,this.name="MOZ_texture_rgbe"}loadTexture(e){const t=this.parser,i=t.json.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const s=i.extensions[this.name].source;return t.loadTextureImage(e,s,this.loader).then((e=>(e.minFilter===THREE.NearestMipmapNearestFilter||e.minFilter===THREE.NearestMipmapLinearFilter?e.minFilter=THREE.NearestFilter:e.minFilter!==THREE.LinearMipmapNearestFilter&&e.minFilter!==THREE.LinearMipmapLinearFilter||(e.minFilter=THREE.LinearFilter),e))).catch((e=>{console.error("issue while loading hdr texture",e)}))}}class b{constructor(e){this.parser=e,this.name="MOZ_hubs_components"}afterRoot({scenes:e,parser:t}){const i=[],s=(e,s)=>{const n=t.associations.get(s)?.[e];if(void 0===n)return;const o=t.json[e][n].extensions?.[this.name];if(o){s.userData.gltfExtensions=Object.assign(s.userData.gltfExtensions||{},{MOZ_hubs_components:o});for(const e in o){const s=o[e];for(const e in s){const n=s[e],o=n?.__mhc_link_type;o&&void 0!==n.index&&i.push(t.getDependency(o,n.index).then((i=>{if("node"!==o)return"texture"!==o||t.json.textures[n.index].extensions?.MOZ_texture_rgbe||(i.encoding=THREE.sRGBEncoding),s[e]=i,i})))}}}};for(let i=0;i<e.length;i++)t.associations.set(e[i],{scenes:i}),e[i].traverse((e=>{var t,i;s("scenes",e),s("nodes",e),t=e,i=s.bind(this,"materials"),!t.material||(Array.isArray(t.material)?t.material.map(i):i(t.material))}));return Promise.all(i)}}class w{constructor(e){this.parser=e,this.name="MOZ_lightmap"}loadMaterial(e){const t=this.parser,i=t.json.materials[e];if(!i.extensions||!i.extensions[this.name])return null;const s=i.extensions[this.name],n=[];return n.push(t.loadMaterial(e)),n.push(t.getDependency("texture",s.index)),Promise.all(n).then((e=>{const t=e[0],i=e[1];return t.lightMap=i,t.lightMapIntensity=void 0!==s.intensity?s.intensity:1,t.isMeshBasicMaterial&&(t.lightMapIntensity*=Math.PI),t})).catch((e=>{console.error("issue while loading MOZ_lightmap material",e)}))}}function T(e){for(const t in e){const i=e[t];if(i instanceof THREE.Texture){const e=i.source.data;e instanceof ImageBitmap&&e.close&&e.close(),i.dispose()}}}function x(e){if(e.fakeEl&&e.fakeEl.destroy(),e instanceof THREE.Mesh){const t=e.geometry;t&&t.dispose();const i=e.material;if(i)if(Array.isArray(i))for(let e=0,t=i.length;e<t;e++){const t=i[e];T(t),t.dispose()}else T(i),i.dispose()}}const M={schema:{type:"model"},init:function(){const e=this,i=this.el.sceneEl.systems["gltf-model"].getDRACOLoader(),s=this.el.sceneEl.systems["gltf-model"].getMeshoptDecoder(),n=this.el.sceneEl.systems["gltf-model"].getKTX2Loader();this.model=null,this.removers=[],this.loader=new THREE.GLTFLoader,this.mixer=null,this.loader.register((e=>new b(e))).register((e=>new w(e))).register((e=>new E(e,(new t).setDataType(THREE.HalfFloatType)))),i&&this.loader.setDRACOLoader(i),this.ready=s?s.then((function(t){e.loader.setMeshoptDecoder(t)})):Promise.resolve(),n&&this.loader.setKTX2Loader(n)},update:function(){const e=this,t=this.el,i=this.data;this.remove(),i&&this.ready.then((function(){e.el.emit("model-loading",{src:i}),e.loader.load(i,(function(s){t.emit("model-downloaded"),e.model=s.scene||s.scenes[0],e.model.animations=s.animations,t.setObject3D("mesh",e.model);const n=s.animations,o=[];let r=null;s.scene.traverse((t=>{if(t.isMesh&&(t.reflectionProbeMode="static"),t.userData.gltfExtensions&&t.userData.gltfExtensions.MOZ_hubs_components){const a=t.userData.gltfExtensions.MOZ_hubs_components;console.log(i,a,t.name),Object.entries(a).forEach((([i,l])=>{if("environment-settings"===i)r=l;else if("visible"===i)t.visible=l.visible;else if("networked"===i);else if("loop-animation"===i){e.mixer||(e.mixer=new THREE.AnimationMixer(s.scene),e.tick=function(t,i){e.mixer&&!isNaN(i)&&e.mixer.update(i/1e3)},e.el.sceneEl.addBehavior(e));const i=l.activeClipIndices;let o=[];if(i&&i.length>0)o=i.map((e=>n[e]));else{const e=l.clip;if(""!==e){const t=e.split(",");for(let e=0;e<t.length;e++){const i=t[e],s=n.find((({name:e})=>e===i));s?o.push(s):console.warn(`Could not find animation named '${i}'`)}}}for(let i=0;i<o.length;i++){const s=e.mixer.clipAction(o[i],t);s.enabled=!0,s.setLoop(THREE.LoopRepeat,1/0).play()}}else{const s=f.get(i);s?o.push((()=>{const n=s(t,l,a);n&&e.removers.push((()=>{if(n.object3D.traverse(x),n.parentNode&&n.parentNode.removeChild(n),"nav-mesh"===i){const e=document.querySelector("#rig,#cameraRig");e?.removeAttribute("simple-navmesh-constraint")}}))})):console.warn(`Unknown Hubs component '${i}'`)}}))}}));for(let e=0;e<o.length;e++)o[e]();o.length=0,r||(r=a),t.emit("model-loaded",{format:"gltf",model:e.model,environmentSettings:r}),t.classList?.contains("environment-settings")&&(f.get("environment-settings")(t.sceneEl,r),queueMicrotask((()=>{t.sceneEl.emit("waypoints-ready")}))),setTimeout((()=>{t.sceneEl.renderer.shadowMap.needsUpdate=!0}),2e3)}),(function(e){t.emit("progress",{originalEvent:e})}),(function(e){t.emit("model-downloaded"),console.error(e,i);const s=e&&e.message?e.message:"Failed to load glTF model";console.warn(s),t.emit("model-error",{format:"gltf",src:i})}))}))},remove:function(){if(this.model){this.mixer&&(this.mixer.stopAllAction(),this.mixer=null,this.el.sceneEl.removeBehavior(this),this.tick=void 0);for(let e=0;e<this.removers.length;e++)this.removers[e]();this.removers.length=0,this.el.removeObject3D("mesh"),this.model.traverse(x),this.model=null}}};AFRAME.registerComponent("gltf-model-plus",M),function(){const e=document.createElement("template"),t=document.createElement("a-entity");e.id="media-template",e.appendChild(t);const i=`#${e.id}`;NAF.schemas.schemaDict[i]={template:i,components:["position","rotation","scale","video-texture-target"]},NAF.schemas.templateCache[i]=e}();const S=[],A=new Map;AFRAME.registerSystem("media-frame",{getClosestMediaFrame:function(e){let t=S;e&&"all"!==e&&(t="all-2d"===e?t.filter((e=>"model"!==e.component.data.mediaType)):"model"===e?t.filter((t=>{const i=t.component.data.mediaType;return i===e||"all"===i})):t.filter((t=>{const i=t.component.data.mediaType;return i===e||"all"===i||"all-2d"===i})));const i=document.querySelector("#rig,#cameraRig").object3D.position;return t.sort(((e,t)=>e.el.object3D.position.distanceTo(i)<t.el.object3D.position.distanceTo(i)?-1:1)),t.length>0?t[0]:document.getElementById("screenshare")},getMediaFrameById(e){const t=A.get(e);return t?t.el:document.getElementById("screenshare")}}),AFRAME.registerComponent("media-frame",{schema:{bounds:{type:"vec3",default:{x:1,y:1,z:1}},mediaType:{type:"string",oneOf:["all","all-2d","model","image","video","pdf"],default:"all-2d"},snapToCenter:{type:"boolean",default:!0}},play(){const e=this.el.components.networked.data.networkId,t={component:this,el:this.el,id:e};this.instance=t,A.set(e,t),S.push(t)},pause(){A.delete(this.instance.id),S.splice(S.indexOf(this.instance),1)}}),s(527);class F{constructor(e=Math){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(let t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(let e=0;e<512;e++)this.perm[e]=this.p[255&e];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(e,t,i){return e[0]*t+e[1]*i}dot3(e,t,i,s){return e[0]*t+e[1]*i+e[2]*s}dot4(e,t,i,s,n){return e[0]*t+e[1]*i+e[2]*s+e[3]*n}noise(e,t){let i,s,n;const o=(e+t)*(.5*(Math.sqrt(3)-1)),a=Math.floor(e+o),r=Math.floor(t+o),l=(3-Math.sqrt(3))/6,c=(a+r)*l,d=e-(a-c),h=t-(r-c);let p,m;d>h?(p=1,m=0):(p=0,m=1);const u=d-p+l,g=h-m+l,f=d-1+2*l,v=h-1+2*l,y=255&a,E=255&r,b=this.perm[y+this.perm[E]]%12,w=this.perm[y+p+this.perm[E+m]]%12,T=this.perm[y+1+this.perm[E+1]]%12;let x=.5-d*d-h*h;x<0?i=0:(x*=x,i=x*x*this.dot(this.grad3[b],d,h));let M=.5-u*u-g*g;M<0?s=0:(M*=M,s=M*M*this.dot(this.grad3[w],u,g));let S=.5-f*f-v*v;return S<0?n=0:(S*=S,n=S*S*this.dot(this.grad3[T],f,v)),70*(i+s+n)}noise3d(e,t,i){let s,n,o,a;const r=(e+t+i)*(1/3),l=Math.floor(e+r),c=Math.floor(t+r),d=Math.floor(i+r),h=1/6,p=(l+c+d)*h,m=e-(l-p),u=t-(c-p),g=i-(d-p);let f,v,y,E,b,w;m>=u?u>=g?(f=1,v=0,y=0,E=1,b=1,w=0):m>=g?(f=1,v=0,y=0,E=1,b=0,w=1):(f=0,v=0,y=1,E=1,b=0,w=1):u<g?(f=0,v=0,y=1,E=0,b=1,w=1):m<g?(f=0,v=1,y=0,E=0,b=1,w=1):(f=0,v=1,y=0,E=1,b=1,w=0);const T=m-f+h,x=u-v+h,M=g-y+h,S=m-E+2*h,A=u-b+2*h,F=g-w+2*h,R=m-1+.5,D=u-1+.5,H=g-1+.5,L=255&l,O=255&c,j=255&d,_=this.perm[L+this.perm[O+this.perm[j]]]%12,k=this.perm[L+f+this.perm[O+v+this.perm[j+y]]]%12,N=this.perm[L+E+this.perm[O+b+this.perm[j+w]]]%12,C=this.perm[L+1+this.perm[O+1+this.perm[j+1]]]%12;let U=.6-m*m-u*u-g*g;U<0?s=0:(U*=U,s=U*U*this.dot3(this.grad3[_],m,u,g));let B=.6-T*T-x*x-M*M;B<0?n=0:(B*=B,n=B*B*this.dot3(this.grad3[k],T,x,M));let V=.6-S*S-A*A-F*F;V<0?o=0:(V*=V,o=V*V*this.dot3(this.grad3[N],S,A,F));let P=.6-R*R-D*D-H*H;return P<0?a=0:(P*=P,a=P*P*this.dot3(this.grad3[C],R,D,H)),32*(s+n+o+a)}noise4d(e,t,i,s){const n=this.grad4,o=this.simplex,a=this.perm,r=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20;let c,d,h,p,m;const u=(e+t+i+s)*r,g=Math.floor(e+u),f=Math.floor(t+u),v=Math.floor(i+u),y=Math.floor(s+u),E=(g+f+v+y)*l,b=e-(g-E),w=t-(f-E),T=i-(v-E),x=s-(y-E),M=(b>w?32:0)+(b>T?16:0)+(w>T?8:0)+(b>x?4:0)+(w>x?2:0)+(T>x?1:0),S=o[M][0]>=3?1:0,A=o[M][1]>=3?1:0,F=o[M][2]>=3?1:0,R=o[M][3]>=3?1:0,D=o[M][0]>=2?1:0,H=o[M][1]>=2?1:0,L=o[M][2]>=2?1:0,O=o[M][3]>=2?1:0,j=o[M][0]>=1?1:0,_=o[M][1]>=1?1:0,k=o[M][2]>=1?1:0,N=o[M][3]>=1?1:0,C=b-S+l,U=w-A+l,B=T-F+l,V=x-R+l,P=b-D+2*l,W=w-H+2*l,I=T-L+2*l,q=x-O+2*l,z=b-j+3*l,$=w-_+3*l,G=T-k+3*l,Z=x-N+3*l,Y=b-1+4*l,X=w-1+4*l,Q=T-1+4*l,K=x-1+4*l,J=255&g,ee=255&f,te=255&v,ie=255&y,se=a[J+a[ee+a[te+a[ie]]]]%32,ne=a[J+S+a[ee+A+a[te+F+a[ie+R]]]]%32,oe=a[J+D+a[ee+H+a[te+L+a[ie+O]]]]%32,ae=a[J+j+a[ee+_+a[te+k+a[ie+N]]]]%32,re=a[J+1+a[ee+1+a[te+1+a[ie+1]]]]%32;let le=.6-b*b-w*w-T*T-x*x;le<0?c=0:(le*=le,c=le*le*this.dot4(n[se],b,w,T,x));let ce=.6-C*C-U*U-B*B-V*V;ce<0?d=0:(ce*=ce,d=ce*ce*this.dot4(n[ne],C,U,B,V));let de=.6-P*P-W*W-I*I-q*q;de<0?h=0:(de*=de,h=de*de*this.dot4(n[oe],P,W,I,q));let he=.6-z*z-$*$-G*G-Z*Z;he<0?p=0:(he*=he,p=he*he*this.dot4(n[ae],z,$,G,Z));let pe=.6-Y*Y-X*X-Q*Q-K*K;return pe<0?m=0:(pe*=pe,m=pe*pe*this.dot4(n[re],Y,X,Q,K)),27*(c+d+h+p+m)}}const R=s.p+"assets/537ec85b965d414829ab.jpg";class D{constructor(t=new e.Vector2(1,1),i=new e.Vector2(1,1),s=.0025,n=!0){this.speed=t,this.scale=i,this.height=s,this.alternate=n}}class H extends e.Mesh{constructor(t,i=24,s=!1){const n=new e.PlaneGeometry(10,10,i,i);n.rotateX(-Math.PI/2);const o={ripplesSpeed:{value:.25},ripplesScale:{value:1},time:{value:0}},a=s?e.MeshPhongMaterial:e.MeshStandardMaterial;t.wrapS=t.wrapT=e.RepeatWrapping;const r=new a({color:21727,normalMap:t,roughness:.5,metalness:.5});r.name="SimpleWaterMaterial",r.onBeforeCompile=e=>{Object.assign(e.uniforms,o),e.vertexShader=e.vertexShader.replace("#include <fog_pars_vertex>","\n        #include <fog_pars_vertex>\n        varying vec3 vWPosition;\n      "),e.vertexShader=e.vertexShader.replace("#include <fog_vertex>","\n        #include <fog_vertex>\n        vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;\n      "),e.fragmentShader=e.fragmentShader.replace("#include <normalmap_pars_fragment>","\n        #include <normalmap_pars_fragment>\n\n        uniform float time;\n        uniform float ripplesSpeed;\n        uniform float ripplesScale;\n      \n        varying vec3 vWPosition;\n      \n        vec4 getNoise(vec2 uv){\n          float timeOffset = time * ripplesSpeed;\n          uv = (uv - 0.5) * (1.0 / ripplesScale);\n          vec2 uv0 = (uv/103.0)+vec2(timeOffset/17.0, timeOffset/29.0);\n          vec2 uv1 = uv/107.0-vec2(timeOffset/-19.0, timeOffset/31.0);\n          vec2 uv2 = uv/vec2(897.0, 983.0)+vec2(timeOffset/101.0, timeOffset/97.0);\n          vec2 uv3 = uv/vec2(991.0, 877.0)-vec2(timeOffset/109.0, timeOffset/-113.0);\n          vec4 noise = (texture2D(normalMap, uv0)) +\n                       (texture2D(normalMap, uv1)) +\n                       (texture2D(normalMap, uv2)) +\n                       (texture2D(normalMap, uv3));\n          return noise / 4.0;\n        }\n      "),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>","\n          // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n          vec3 eye_pos = -vViewPosition;\n          vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n          vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n          vec2 st0 = dFdx( vUv.st );\n          vec2 st1 = dFdy( vUv.st );\n\n          float scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n          vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n          vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n          vec3 N = normalize( normal );\n          mat3 tsn = mat3( S, T, N );\n\n          vec3 mapN = getNoise(vWPosition.xz).xyz * 2.0 - 1.0;\n\n          mapN.xy *= normalScale;\n          mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n          normal = normalize( tsn * mapN );\n        ")},super(n,r),this.lowQuality=s,this.waterUniforms=o,s?this.material.specular.set(16777215):this.receiveShadow=!0,this.geometry.attributes.position.dynamic=!0,this.resolution=i,this.octaves=[new D(new e.Vector2(.5,.5),new e.Vector2(1,1),.01,!0),new D(new e.Vector2(.05,6),new e.Vector2(1,20),.1,!1)],this.simplex=new F}get opacity(){return this.material.opacity}set opacity(e){this.material.opacity=e,this.material.transparent=1!==e}get color(){return this.material.color}get tideHeight(){return this.octaves[0].height}set tideHeight(e){this.octaves[0].height=e}get tideScale(){return this.octaves[0].scale}get tideSpeed(){return this.octaves[0].speed}get waveHeight(){return this.octaves[1].height}set waveHeight(e){this.octaves[1].height=e}get waveScale(){return this.octaves[1].scale}get waveSpeed(){return this.octaves[1].speed}set ripplesSpeed(e){this.waterUniforms.ripplesSpeed.value=e}get ripplesSpeed(){return this.waterUniforms.ripplesSpeed.value}set ripplesScale(e){this.waterUniforms.ripplesScale.value=e}get ripplesScale(){return this.waterUniforms.ripplesScale.value}update(e){const t=this.geometry.attributes.position;for(let i=0;i<=this.resolution;i++)for(let s=0;s<=this.resolution;s++){let n=0;for(let t=0;t<this.octaves.length;t++){const o=this.octaves[t];if(o.alternate){const t=this.simplex.noise(i*o.scale.x/this.resolution,s*o.scale.y/this.resolution);n+=Math.cos(t+o.speed.length()*e)*o.height}else n+=(this.simplex.noise((i*o.scale.x+e*o.speed.x)/this.resolution,(s*o.scale.y+e*o.speed.y)/this.resolution)-.5)*o.height}t.setY(i*(this.resolution+1)+s,n)}this.geometry.computeVertexNormals(),t.needsUpdate=!0,this.waterUniforms.time.value=e}clone(e){return new H(this.material.normalMap,this.resolution,this.lowQuality).copy(this,e)}copy(e,t=!0){return super.copy(e,t),this.opacity=e.opacity,this.color.copy(e.color),this.tideHeight=e.tideHeight,this.tideScale.copy(e.tideScale),this.tideSpeed.copy(e.tideSpeed),this.waveHeight=e.waveHeight,this.waveScale.copy(e.waveScale),this.waveSpeed.copy(e.waveSpeed),this.ripplesSpeed=e.ripplesSpeed,this.ripplesScale=e.ripplesScale,this}}function L(e,t){return e&&t&&e.x===t.x&&e.y===t.y}let O=null;AFRAME.registerComponent("simple-water",{schema:{opacity:{type:"number",default:1},color:{type:"color"},tideHeight:{type:"number",default:.01},tideScale:{type:"vec2",default:{x:1,y:1}},tideSpeed:{type:"vec2",default:{x:.5,y:.5}},waveHeight:{type:"number",default:.1},waveScale:{type:"vec2",default:{x:1,y:20}},waveSpeed:{type:"vec2",default:{x:.05,y:6}},ripplesScale:{type:"number",default:1},ripplesSpeed:{type:"number",default:.25}},init(){O||(O=(new e.TextureLoader).load(R)),this.water=new H(O,void 0,!1),this.el.setObject3D("mesh",this.water)},update(e){this.data.opacity!==e.opacity&&(this.water.opacity=this.data.opacity),this.data.color!==e.color&&this.water.color.set(this.data.color),this.data.tideHeight!==e.tideHeight&&(this.water.tideHeight=this.data.tideHeight),L(this.data.tideScale,e.tideScale)||this.water.tideScale.copy(this.data.tideScale),L(this.data.tideSpeed,e.tideSpeed)||this.water.tideSpeed.copy(this.data.tideSpeed),this.data.waveHeight!==e.waveHeight&&(this.water.waveHeight=this.data.waveHeight),L(this.data.waveScale,e.waveScale)||this.water.waveScale.copy(this.data.waveScale),L(this.data.waveSpeed,e.waveSpeed)||this.water.waveSpeed.copy(this.data.waveSpeed),this.data.ripplesScale!==e.ripplesScale&&(this.water.ripplesScale=this.data.ripplesScale),this.data.ripplesSpeed!==e.ripplesSpeed&&(this.water.ripplesSpeed=this.data.ripplesSpeed)},tick(e){this.water.update(e/1e3)},remove(){const e=this.el.getObject3D("mesh");e.geometry.dispose(),e.material.dispose(),this.el.removeObject3D("mesh")}}),s(114),s(344),s(210)})(),n})()));
//# sourceMappingURL=gltf-model-plus.min.js.map